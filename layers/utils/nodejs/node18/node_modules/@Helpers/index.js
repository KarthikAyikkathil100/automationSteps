const axios = require('axios')
const videoIntelligence = require('@google-cloud/video-intelligence').v1;
const { Storage } = require('@google-cloud/storage');
const { getByName } = require('../@AwsHelpers/SSM/index')


async function getKey(name) {
    try {
        let creds = await getByName(name)
        resCreds = JSON.parse(creds)
        return resCreds
    } catch (e) {
        console.log('Error while fetching ssm key => {}')
        return null
    }
}


async function getCloudStorageClient(name) {
    try {
        const key = await getKey(name)
        if (!key) {
            throw new Error('Key not found')
        }
        const storage = new Storage({
            credentials: key
        })
        return storage
    } catch (e) {
        console.log('Error while prepping GCS client')
        return null
    }
}


async function getVideoIntelligenceClient(name) { 
    try {
        const key = await getKey(name)
        if (!key) {
            throw new Error('Key not found')
        }
        const client = new videoIntelligence.VideoIntelligenceServiceClient({
            credentials: key
        });

        return client
    } catch (e) {
        console.log('Error while fetching VideoIntelligence')
        console.log(e)
        return null
    }
}





module.exports = {
    axios,
    getCloudStorageClient,
    getVideoIntelligenceClient
}